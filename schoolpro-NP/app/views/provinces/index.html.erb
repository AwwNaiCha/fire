<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDB06c3JC9Puup5N4gk3cK1j9sQ0kO615U&sensor=false"></script>
  <style type="text/css">
    #mapDiv {
      width: 1400px;
      height: 800px;
    }

  </style>

  <script type="text/javascript">
    var map;
	var parklocs = '<%= @locations.to_json %>'
	var parklocs = JSON.parse(parklocs.replace(/&quot;/g,'"'));
	var firelevel = '<%= @firelevel.to_json %>'
	var firelevel = JSON.parse(firelevel.replace(/&quot;/g,'"'));
	
	//console.log(parklocs);
	//console.log(firelevel);
	
	
    function initMap() {
      google.maps.visualRefresh = true;

      var mapOptions = {
        zoom: 1,
        mapTypeControlOptions: {mapTypeIds:
            [google.maps.MapTypeId.ROADMAP]}
      };

      var mapElement = document.getElementById('mapDiv');
      map = new google.maps.Map(mapElement, mapOptions);
      map.setMapTypeId(google.maps.MapTypeId.ROADMAP);

      //Load GeoJSON
      //map.data.loadGeoJson("<%= provinces_path format: :json -%>");
      map.data.loadGeoJson("/parks.json");
	  
      map.setZoom(5);
      var gabon = new google.maps.LatLng(38.4230, -95.9717);
      map.setCenter(gabon);

      //Create an info box for displaying names
      var infoBox = document.createElement('div');
      infoBox.innerHTML = "<div id='info-box'></div>";
      map.controls[google.maps.ControlPosition.RIGHT_TOP].push(infoBox);

      map.data.addListener('mouseover', function(event) {
        map.data.revertStyle();
        $('#info-box').text(event.feature.getProperty('name'));
        map.data.overrideStyle(event.feature, { fillColor: 'red' });

      });

      map.data.addListener('mouseout', function(event){
        map.data.revertStyle();
      });
      
	  /*
      map.data.setStyle(function(feature) {
        return { fillColor: 'green',
          strokeWeight: 1}
      });
     */

      map.data.setStyle(function(feature) {
  		  var level = 0;
  		  var color = 'gray';
  		  //console.log(feature.getProperty('name'));
		  for(var i = 0; i < firelevel.length; i++) {
			  if (firelevel[i].park_name.indexOf(feature.getProperty('name')) != -1 || feature.getProperty('name').indexOf(firelevel[i].park_name) != -1) {
				  level = firelevel[i].level;
				  break;
			  }
		  }
		  /*
		  if(i == 57) {
			  console.log('i=57');
		  } 
		  */
		  
  		  if( level == "1") {
  			  color = 'blue';
  		  } else if (level == "2") {
  			  color = 'red';
  		  } else if (level == "3") {
  	    	  color = 'yellow';
  		  } else if (level == "4") {
  			  color = 'green';
  		  } else if (level == "5") {
  			  color = 'black';
  		  }
		  
  		  return /** @type {google.maps.Data.StyleOptions} */({
  		       fillColor: color,
  		       strokeColor: color,
  		       strokeWeight: 2
  		  });
	  });

	  

	  
	  
    }

    function zoomToUSA() {
        var istanbul = new google.maps.LatLng(38.4230, -95.9717);
		map.setZoom(5);
        map.setCenter(istanbul);
		
	  

    }

    function zoomToMarks() {
		var d = new Date();
		console.log(d);
		console.log(d.getDate());
        console.log(d.getMonth());
		console.log(d.getFullYear());
		
		for(i = 0; i < parklocs.length; i++) {
			var myLatLng = {lat: Number(parklocs[i].latitude), lng: Number(parklocs[i].longitude)};
			var marker = new google.maps.Marker({
	     	   position: myLatLng,
	      	   map: map,
	      	   title: parklocs[i].park_name + '\n' + 'Double click to details'
	   	 	});
			

			
		    google.maps.event.addListener(marker, 'click', (function(marker, i) {
				var contentString = '<h2> Park Name: '+ parklocs[i].park_name + '</h2>' + '<h1> double click to see details </h1>';  
		         return function() {
		 			var infowindow = new google.maps.InfoWindow({
		 			    content: contentString
		 			  });			
					infowindow.open(map, marker);
	 	    		map.setZoom(10);
	 	    		map.setCenter(marker.getPosition());
		         }
		    })(marker, i));
			
		    google.maps.event.addListener(marker, "dblclick", (function(marker, i) {
		         return function() {
					 window.location.href="/visitornumbers/" + String(i + 1);
		         }
		    })(marker, i));
		};


    }

    function redirectToParkList() {
		window.location.href="/visitornumbers";
    }

    function setMaxZoom() {
      map.setOptions({maxZoom: 12});
    }

    function setMinZoom() {
      map.setOptions({minZoom: 5});
    }

    function changeUI() {
      map.setOptions({disableDefaultUI: true});
    }

    function disableScroll() {
      map.setOptions({scrollwheel: false});
    }

    function startButtonEvents() {
      document.getElementById('btnZoomToUSA')
          .addEventListener('click', function(){
            zoomToUSA();
          });

      document.getElementById('btnZoomToMarks')
          .addEventListener('click', function() {
            zoomToMarks();
          });

      document.getElementById('btnredirecToParkList')
          .addEventListener('click', function(){
            redirectToParkList();
          });

      document.getElementById('btnMaxZoom')
          .addEventListener('click', function() {
            setMaxZoom();
          });
      document.getElementById('btnMinZoom')
          .addEventListener('click', function() {
            setMinZoom();
          });
      document.getElementById('btnChangeUI')
          .addEventListener('click', function() {
            changeUI();
          })
      document.getElementById('btnDisableScroll')
          .addEventListener('click', function() {
            disableScroll();
          });
    }

    google.maps.event.addDomListener(window, 'load', initMap);
    document.addEventListener('DOMContentLoaded', startButtonEvents);
	
  </script>
</head>
<body>
	
<h1>National Parks in USA</h1>

<div>
  <input id="btnZoomToUSA" type="button" class="button small" value="Zoom To USA" />
  <input id="btnZoomToMarks" type="button" class="button small" value="Zoom To Park Marks" />
  <input id="btnredirecToParkList" type="button" class="button small" value="Go To Park List" />
</div>
<div>
	<div id="mapDiv">
</div>

</section>


</body>
</html>