<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDB06c3JC9Puup5N4gk3cK1j9sQ0kO615U&sensor=false"></script>
  <style type="text/css">
    #mapDiv {
      width: 1400px;
      height: 800px;
    }

  </style>

  <script type="text/javascript">
    var map;
	var parklocs = '<%= @locations.to_json %>'
	var parklocs = JSON.parse(parklocs.replace(/&quot;/g,'"'));;
	//console.log(parklocs);
	
	
    function initMap() {
      google.maps.visualRefresh = true;

      var mapOptions = {
        zoom: 1,
        mapTypeControlOptions: {mapTypeIds:
            [google.maps.MapTypeId.ROADMAP]}
      };

      var mapElement = document.getElementById('mapDiv');
      map = new google.maps.Map(mapElement, mapOptions);
      map.setMapTypeId(google.maps.MapTypeId.ROADMAP);

      //Load GeoJSON
      //map.data.loadGeoJson("<%= provinces_path format: :json -%>");
      map.data.loadGeoJson("/parks.json");
	  
      map.setZoom(5);
      var gabon = new google.maps.LatLng(38.4230, -95.9717);
      map.setCenter(gabon);

      //Create an info box for displaying names
      var infoBox = document.createElement('div');
      infoBox.innerHTML = "<div id='info-box'></div>";
      map.controls[google.maps.ControlPosition.RIGHT_TOP].push(infoBox);

      map.data.addListener('mouseover', function(event) {
        map.data.revertStyle();
        $('#info-box').text(event.feature.getProperty('name'));
        map.data.overrideStyle(event.feature, { fillColor: 'red' });

      });

      map.data.addListener('mouseout', function(event){
        map.data.revertStyle();
      });

      map.data.setStyle(function(feature) {
        return { fillColor: 'green',
          strokeWeight: 1}
      });


    }

    function zoomToUSA() {
        var istanbul = new google.maps.LatLng(38.4230, -95.9717);
		map.setZoom(5);
        map.setCenter(istanbul);
    }

    function zoomToMarks() {


		for(i = 0; i < parklocs.length; i++) {
			var myLatLng = {lat: Number(parklocs[i].latitude), lng: Number(parklocs[i].longitude)};
			var marker = new google.maps.Marker({
	     	   position: myLatLng,
	      	   map: map,
	      	   title: parklocs[i].park_name
	   	 	});
			
			
		    google.maps.event.addListener(marker, 'click', (function(marker, i) {
		         return function() {
	 	    		map.setZoom(10);
	 	    		map.setCenter(marker.getPosition());
		         }
		    })(marker, i));
		};


    }

    function disableDrag() {
      map.setOptions({draggable: false});
    }

    function setMaxZoom() {
      map.setOptions({maxZoom: 12});
    }

    function setMinZoom() {
      map.setOptions({minZoom: 5});
    }

    function changeUI() {
      map.setOptions({disableDefaultUI: true});
    }

    function disableScroll() {
      map.setOptions({scrollwheel: false});
    }

    function startButtonEvents() {
      document.getElementById('btnZoomToUSA')
          .addEventListener('click', function(){
            zoomToUSA();
          });

      document.getElementById('btnZoomToMarks')
          .addEventListener('click', function() {
            zoomToMarks();
          });

      document.getElementById('btnDisableDrag')
          .addEventListener('click', function(){
            disableDrag();
          });

      document.getElementById('btnMaxZoom')
          .addEventListener('click', function() {
            setMaxZoom();
          });
      document.getElementById('btnMinZoom')
          .addEventListener('click', function() {
            setMinZoom();
          });
      document.getElementById('btnChangeUI')
          .addEventListener('click', function() {
            changeUI();
          })
      document.getElementById('btnDisableScroll')
          .addEventListener('click', function() {
            disableScroll();
          });
    }

    google.maps.event.addDomListener(window, 'load', initMap);
    document.addEventListener('DOMContentLoaded', startButtonEvents);
	
  </script>
</head>
<body>
	
<h1>National Parks in USA</h1>

<div>
  <input id="btnZoomToUSA" type="button" class="button small" value="Zoom To USA" />
  <input id="btnZoomToMarks" type="button" class="button small" value="Zoom To Park Marks" />
  <input id="btnMaxZoom" type="button" class="button small" value="Go To Park List" />
</div>
<div>
	<div id="mapDiv">
</div>

</section>


</body>
</html>